from aiogram.filters import Command
from aiogram import types, F
from main import dp, bot, db
from keyboards.keyboard import mainmenu, sttart, kb, check_menu_keyboard
import time
#from config import BOT_NICKNAME
from config import BOT_NICKNAME
from aiogram.exceptions import TelegramBadRequest

# –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã
@dp.message(Command('start'))
async def start(message: types.Message):
    if message.chat.type == 'private':
        if not db.user_exists(message.from_user.id):
            start_command = message.text
            referrer_id = str(start_command[7:])

            if referrer_id != "":
                if referrer_id != str(message.from_user.id):
                    db.add_user(message.from_user.id, message.from_user.first_name, referrer_id)

                    try:
                        await bot.send_message(referrer_id, "–ü–æ –≤–∞—à–µ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ –∫—Ç–æ-—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª—Å—è!üéâ")

                        # –ù–∞—á–∏—Å–ª—è–µ–º —Ä–µ—Ñ–µ—Ä–µ—Ä—É 500 –∫–ª–∏–∫–æ–≤
                        await db.reward_referrer(referrer_id)

                    except:
                        pass
                else:
                    db.add_user(message.from_user.id, message.from_user.first_name)
                    await bot.send_message(message.from_user.id, '–ü–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Å—ã–ª–∫–µ –Ω–µ–ª—å–∑—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è‚ùó')
            else:
                db.set_active(message.from_user.id, 1)
                db.add_user(message.from_user.id, message.from_user.first_name)

        db.set_active(message.from_user.id, 1)
        await bot.send_photo(
            message.from_user.id,
            photo='https://ibb.co/T4s4021',
            caption=(
                'üëã–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>Dinosaur Clicker</b>!ü¶ñ\n\n'
                '–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å ü¶ñ<b>$Dinocoin</b>, –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É! üí∞\n\n'
                '–ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∏ –Ω–∞–≥—Ä–∞–¥–∞–ºü™ê\n\n'
                'üîπ–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É! üöÄ\n\n'
                '–î–ª—è –ø–æ–º–æ—â–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /help'
            ),
            reply_markup=sttart
        )
    else:
        await bot.send_message(message.chat.id, text="–Ø —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö")


@dp.callback_query(F.data.startswith('refka'))
async def refka(call: types.CallbackQuery):
    await call.message.edit_caption(caption=f'üôã–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –¥—Ä—É–∑–µ–π –∏ –∑–Ω–∞–∫–æ–º—ã—Ö!üôã\n\nüí∞–ó–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–∏–≤–µ–¥—ë–Ω–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞, –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>500 $Dinocoin</b> –∏ 10% –æ—Ç –µ–≥–æ –∫–ª–∏–∫–æ–≤üí∞\n\nü¶ñ–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: https://t.me/{BOT_NICKNAME}?start={call.from_user.id} ü¶ñ\n\nü§†–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—à–∏—Ö —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤: {db.count_referals(call.from_user.id)} ü§†', reply_markup=mainmenu)

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ
@dp.message(Command('rules'))
async def rules(message: types.Message):
    if message.chat.type == 'private':
        rules_text = """
            <b>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ:</b>
            
            1. <b>–û–±—â–∏–µ –ø–æ–ª–æ–∂–µ–Ω–∏—è</b>
            –ù–∞—Å—Ç–æ—è—â–µ–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–µ —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ (–¥–∞–ª–µ–µ ‚Äî "–°–æ–≥–ª–∞—à–µ–Ω–∏–µ") —è–≤–ª—è–µ—Ç—Å—è —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º –¥–æ–≥–æ–≤–æ—Ä–æ–º –º–µ–∂–¥—É –≤–∞–º–∏ (–¥–∞–ª–µ–µ ‚Äî "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å") –∏ –≤–ª–∞–¥–µ–ª—å—Ü–µ–º –±–æ—Ç–∞ (–¥–∞–ª–µ–µ ‚Äî "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è"). –ò—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω–æ–≥–æ –±–æ—Ç–∞, –≤—ã –≤—ã—Ä–∞–∂–∞–µ—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ —Å —É—Å–ª–æ–≤–∏—è–º–∏, –∏–∑–ª–æ–∂–µ–Ω–Ω—ã–º–∏ –≤ –°–æ–≥–ª–∞—à–µ–Ω–∏–∏.
            –ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ —É—Å–ª–æ–≤–∏—è—Ö "–∫–∞–∫ –µ—Å—Ç—å" ("as is") –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –≥–∞—Ä–∞–Ω—Ç–∏–π. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ –ª—é–±—ã–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏, —Å–±–æ–∏, –Ω–µ—Ç–æ—á–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞.
            
            2. <b>–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –±–æ—Ç–∞</b>
            –ë–æ—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–∞–∑–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –∏–ª–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã—Ö –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.
            –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –±–æ—Ç–µ, –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç—Å—è –Ω–∞ –µ–≥–æ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ –∏ —Ä–∏—Å–∫. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å–æ–∑–Ω–∞–µ—Ç –∏ —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è, —á—Ç–æ –±–æ—Ç –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö —É—Å–ª—É–≥ —Å —é—Ä–∏–¥–∏—á–µ—Å–∫–∏ –∑–Ω–∞—á–∏–º—ã–º–∏ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è–º–∏.
            
            3. <b>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏</b>
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è –æ—Ç –ª—é–±–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —É–±—ã—Ç–∫–∏, —É—â–µ—Ä–±, —É—Ç—Ä–∞—Ç—É –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ —Ä–µ–ø—É—Ç–∞—Ü–∏–∏, –≤–æ–∑–Ω–∏–∫—à–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –±—ã–ª –ª–∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏–∑–≤–µ—Å—Ç–µ–Ω —Ä–∏—Å–∫ —Ç–∞–∫–∏—Ö —É–±—ã—Ç–∫–æ–≤.
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é, –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é –∏ –±–µ—Å–ø–µ—Ä–µ–±–æ–π–Ω—É—é —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞. –í—Å—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –≤–æ–∑–º–æ–∂–Ω—ã–µ —É–±—ã—Ç–∫–∏, –≤—ã–∑–≤–∞–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏, –ª–µ–∂–∏—Ç –Ω–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.
            
            4. <b>–†–µ–∫–ª–∞–º–∞ –∏ —Ç—Ä–µ—Ç—å–∏ –ª–∏—Ü–∞</b>
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ —Ä–∞–∑–º–µ—â–∞—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∫–æ–Ω—Ç–µ–Ω—Ç, —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Ç—Ä–µ—Ç—å–∏–º–∏ –ª–∏—Ü–∞–º–∏.
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–∞–≤–æ–º–µ—Ä–Ω–æ—Å—Ç—å —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤. –õ—é–±—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è, –≤–æ–∑–Ω–∏–∫–∞—é—â–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∫–ª–∞–º—ã, –∑–∞–∫–ª—é—á–∞—é—Ç—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –º–µ–∂–¥—É –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª–µ–º.
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏–π –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤, —É—Å–ª—É–≥ –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü, —Ä–µ–∫–ª–∞–º–∏—Ä—É–µ–º—ã—Ö –≤ –±–æ—Ç–µ.
            
            5. <b>–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å</b>
            –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–∏–∑–∞–π–Ω–∞, –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –∫–æ–¥ –∏ –¥—Ä—É–≥–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–æ—Ç–∞ —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–∞–º–∏ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –∑–∞—â–∏—â–µ–Ω—ã –∞–≤—Ç–æ—Ä—Å–∫–∏–º –ø—Ä–∞–≤–æ–º –∏ –¥—Ä—É–≥–∏–º–∏ –∑–∞–∫–æ–Ω–∞–º–∏.
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–ø—Ä–µ—â–∞–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –±–æ—Ç–∞ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö –±–µ–∑ –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏–∏.
            
            6. <b>–ü–æ–ª–∏—Ç–∏–∫–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</b>
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–±–∏—Ä–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö (—Ç–∞–∫–∏—Ö –∫–∞–∫ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–º—è), –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –ø—Ä–∏–º–µ–Ω–∏–º—ã–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ–º –æ –∑–∞—â–∏—Ç–µ –¥–∞–Ω–Ω—ã—Ö.
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—è–∑—É–µ—Ç—Å—è –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º, –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–ª—É—á–∞–µ–≤, –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã—Ö –∑–∞–∫–æ–Ω–æ–º.
            
            7. <b>–ò–∑–º–µ–Ω–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π —Å–æ–≥–ª–∞—à–µ–Ω–∏—è</b>
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞ —Å–æ–±–æ–π –ø—Ä–∞–≤–æ –≤–Ω–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç–æ—è—â–µ–µ –°–æ–≥–ª–∞—à–µ–Ω–∏–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è. –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤—Å—Ç—É–ø–∞—é—Ç –≤ —Å–∏–ª—É —Å –º–æ–º–µ–Ω—Ç–∞ –∏—Ö –ø—É–±–ª–∏–∫–∞—Ü–∏–∏. –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ—Ç–∞ –ø–æ—Å–ª–µ –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –æ–∑–Ω–∞—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–Ω—è—Ç–∏–µ –Ω–æ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π.
            
            8. <b>–ü—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞</b>
            –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∏–ª–∏ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É –ª—é–±–æ–º—É –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –±–µ–∑ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∑–∞ –Ω–∞—Ä—É—à–µ–Ω–∏–µ —É—Å–ª–æ–≤–∏–π –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –°–æ–≥–ª–∞—à–µ–Ω–∏—è –∏–ª–∏ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞.
            –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è.\n\n\n–ù–∞–ø–∏—à–∏—Ç–µ /start, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
            """
        await bot.send_message(message.from_user.id, text=rules_text)
    else:
        await bot.send_message(message.chat.id, text="–Ø —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö")

@dp.message(Command('help'))
async def help(message: types.Message):
    if message.chat.type == 'private':
        await bot.send_photo(message.from_user.id, photo='https://ibb.co/T4s4021', caption=f'–ü—Ä–∏–≤–µ—Ç {message.from_user.first_name}!üëã\n–Ø ‚Äî –±–æ—Ç-–∫–ª–∏–∫–µ—Ä! –ö–ª–∏–∫–∞–π –∏ –ø–æ–ª—É—á–∞–π <b>$Dinocoin!</b>üí∞\n\n‚ùì<b>–ó–∞—á–µ–º –º–Ω–µ $Dinocoin?</b>\n<b>$Dinocoin</b> ‚Äî —ç—Ç–æ —Ü–∏—Ñ—Ä–æ–≤–∞—è –≤–∞–ª—é—Ç–∞ –±—É–¥—É—â–µ–≥–æ, –∫–æ—Ç–æ—Ä–∞—è —Å–∫–æ—Ä–æ –ø—Ä–∏–≤–ª–µ—á–µ—Ç –≤–Ω–∏–º–∞–Ω–∏–µ! –í —Å–∫–æ—Ä–æ–º –≤—Ä–µ–º–µ–Ω–∏ –º—ã –ø–ª–∞–Ω–∏—Ä—É–µ–º –µ—ë –ª–∏—Å—Ç–∏–Ω–≥ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–±–∏—Ä–∂–∞—Ö. –°–æ–±–∏—Ä–∞–π –º–æ–Ω–µ—Ç—ã —Å–µ–π—á–∞—Å –∏ –±—É–¥—å –≥–æ—Ç–æ–≤ –æ–±–º–µ–Ω—è—Ç—å –∏—Ö, –∫–æ–≥–¥–∞ $Dinocoin —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ —Ä—ã–Ω–∫–µ!\n\nüìÑ–û–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º —Å–æ–≥–ª–∞—à–µ–Ω–∏–µ–º –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞–≤ –∫–æ–º–∞–Ω–¥—É <b>/rules</b>\n\n–ù–∞–∂–º–∏ –Ω–∞ "<b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>", —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å—Å—è –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.', reply_markup=mainmenu)
    else:
        await bot.send_message(message.chat.id, text="–Ø —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö")

@dp.callback_query(F.data.startswith('mainmenubuuton'))
async def main_menu(call: types.CallbackQuery):
    await call.message.edit_caption(caption=f'–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>Dinosaur Clicker</b>! üéâ\n\n–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å <b>$Dinocoin</b>, –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É! üí∞\n\n–ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∏ –Ω–∞–≥—Ä–∞–¥–∞–º.\n\nüîπ–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É! üöÄ\n\n–î–ª—è –ø–æ–º–æ—â–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /help', reply_markup=sttart)

@dp.callback_query(F.data.startswith('balance'))
async def balance(call: types.CallbackQuery):
    user_balance = await db.count_score(call.from_user.id)
    await call.message.edit_caption(caption=f'ü¶ñ–ù–∞ –≤–∞—à–µ–º –±–∞–ª–∞–Ω—Å–µ <b>{user_balance} $Dinocoin</b>\n\nüí° –ß—Ç–æ–±—ã –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–æ–ª—å—à–µ, –ø—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ –±–æ–ª—å—à–µ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤!\n\nüíØ–ü–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É –º–æ–∂–Ω–æ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é', reply_markup=mainmenu)

@dp.callback_query(F.data.startswith('sstart'))
async def poshla_igra(call: types.CallbackQuery):
    try:
        await call.message.answer(text=f'üëâ –ù–∞–∂–∏–º–∞–π –Ω–∞ –∫–Ω–æ–ø–∫—É "<b>–ö–ª–∏–∫</b>"\n\nüí∏ –ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –∑–∞—á–∏—Å–ª—è–µ—Ç—Å—è 1 <b>$Dinocoin</b>!\n\nüëõ –í—ã –º–æ–∂–µ—Ç–µ —É–∑–Ω–∞—Ç—å—Å—è –±–∞–ª–∞–Ω—Å –Ω–∞–∂–∞–≤ –Ω–∞ –∫–Ω–æ–ø–∫—É: <b>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</b>.', reply_markup=kb)
    finally:
        @dp.message(F.text.lower().contains('–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é'))
        async def delete(message: types.Message):
            await message.answer_photo(photo='https://ibb.co/T4s4021', caption=f'–ü—Ä–∏–≤–µ—Ç! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ <b>Dinosaur Clicker</b>! üéâ\n\n–ó–¥–µ—Å—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å <b>$Dinocoin</b>, –ø—Ä–æ—Å—Ç–æ –∫–ª–∏–∫–∞—è –Ω–∞ –∫–Ω–æ–ø–∫—É! üí∞\n\n–ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç —Ç–µ–±—è –∫ –Ω–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º –∏ –Ω–∞–≥—Ä–∞–¥–∞–º.\n\nüîπ–ù–∞–∂–º–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –Ω–∞—á–Ω–∏ —Å–≤–æ–π –ø—É—Ç—å –∫ —É—Å–ø–µ—Ö—É! üöÄ\n\n–î–ª—è –ø–æ–º–æ—â–∏ –∏—Å–ø–æ–ª—å–∑—É–π –∫–æ–º–∞–Ω–¥—É /help', reply_markup=sttart)


# –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∞
@dp.message(Command('helpadmin'))
async def admin_help(message: types.Message):
    if message.from_user.id == 6822832084:
        active_users_count = db.count_active_users()
        await bot.send_message(message.from_user.id, text=f'–°–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É(–ø—Ä–∏–∫—Ä–µ–ø–ª—è—Ç—å —Ñ–æ—Ç–æ –∏ –ø–æ–¥–ø–∏—Å—å –≤ –æ–¥–Ω–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏, —Ä–∞–∑–º–µ—Ç–∫–∞ HTML) - <b>/admin</b>\n\n–ü–æ–¥—Å—á–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - <b>/countusers</b>\n\n–ò–∑–º–µ–Ω–∏—Ç—å –∫–Ω–æ–ø–∫—É –ó–∞–¥–∞–Ω–∏—è - <b>/admintask</b>\n\n–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–¥–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é - <b>/message</b>')
    else:
        pass
    
# –†–∞—Å—Å—ã–ª–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
@dp.message(Command('admin'))
async def admin(message: types.Message):
    if message.from_user.id == 6822832084:
        text = message.caption if message.photo else message.text  # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç
        if message.photo:
            if not text:
                await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫ —Ñ–æ—Ç–æ.")
                return
            photo = message.photo[-1].file_id  # –ü–æ–ª—É—á–∞–µ–º ID —Ñ–æ—Ç–æ
            users = db.get_users()
            for row in users:
                try:
                    await bot.send_photo(row[0], photo=photo, caption=text[7:])
                    if int(row[1]) != 1:
                        db.set_active(row[0], 1)
                except Exception as e:
                    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {row[0]}: {e}")
                    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ –Ω–µ –ø–æ–º–µ—á–∞–µ–º –µ–≥–æ –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ

        elif message.text:
            if not text or len(text) <= 7:
                await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è —Ä–∞—Å—Å—ã–ª–∫–∏ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã /admin.\n\n–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç - /helpadmin")
                return
            users = db.get_users()
            for row in users:
                try:
                    await bot.send_message(row[0], text=text[7:])
                    if int(row[1]) != 1:
                        db.set_active(row[0], 1)
                except Exception as e:
                    print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {row[0]}: {e}")
                    continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–æ –Ω–µ –ø–æ–º–µ—á–∞–µ–º –µ–≥–æ –∫–∞–∫ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–≥–æ

        else:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –∏–ª–∏ –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç–µ —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é.")
            return

        active_users_count = db.count_active_users()  # –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –∫—Ä—É–≥–ª—ã–º–∏ —Å–∫–æ–±–∫–∞–º–∏
        await bot.send_message(message.from_user.id, text=f'–†–∞—Å—Å—ã–ª–∫–∞ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ {active_users_count} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º.')

# –ö–æ–ª-–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
@dp.message(Command('countusers'))
async def countusers(message: types.Message):
    if message.from_user.id == 6822832084:
        active_users_count = db.count_active_users()
        unactive_users_count = db.count_unactive_users()
        await bot.send_message(message.from_user.id, text=f'–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç - {active_users_count}\n\n–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç - {unactive_users_count}\n\n–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç - /helpadmin')
    else:
        pass

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–ª—è—Ç—å –∑–∞–¥–∞–Ω–∏—è
@dp.message(Command('admintask'))
async def admin_task(message: types.Message):
    if message.from_user.id == 6822832084:  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –∞–¥–º–∏–Ω–∞
        if message.text.startswith("/admintask"):
            # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
            task_data = message.text[10:].split('|', 1)
            if len(task_data) != 2:
                await message.answer("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /admintask –∫–∞–Ω–∞–ª –∫–∞–Ω–∞–ª | —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è\n\n–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç - /helpadmin")
                return

            channels, task_message = task_data
            db.update_task_data(channels.strip(), task_message.strip())

            # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –æ—Ç–º–µ—Ç–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è —É –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            await db.reset_task_status_for_all_users()

            await message.answer("–ó–∞–¥–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ! –°—Ç–∞—Ç—É—Å—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã.")
        else:
            await message.answer("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∑–∞–¥–∞–Ω–∏–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ: /admintask –∫–∞–Ω–∞–ª –∫–∞–Ω–∞–ª | —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è")

# –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∞–¥–º–∏–Ω–∞, —á—Ç–æ–±—ã –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º—É –Ω–∏–±—É–¥—å
@dp.message(Command('message'))
async def send_message_to_user(message: types.Message):
    if message.from_user.id == 6822832084:  # –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ ID –∞–¥–º–∏–Ω–∞
        if message.text.startswith("/message"):
            # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            message_data = message.text[8:].split('|', 1)
            if len(message_data) != 2:
                await message.answer("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: /message id_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è\n\n–í—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ç—É—Ç - /helpadmin")
                return

            user_id, msg_text = message_data[0].strip(), message_data[1].strip()

            try:
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ –µ–≥–æ ID
                await bot.send_message(chat_id=user_id, text=msg_text)
                await message.answer(f"–°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å ID {user_id}.")
            except Exception as e:
                await message.answer(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å ID {user_id}. –û—à–∏–±–∫–∞: {str(e)}")


# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ó–∞–¥–∞–Ω–∏—è"
@dp.callback_query(F.data.startswith('task'))
async def task_handler(call: types.CallbackQuery):
    task_data = db.get_task_data()
    if task_data:
        channels, task_message = task_data
        task_message = f"{task_message}\n\n{channels}"
    else:
        task_message = "‚òπÔ∏è–ó–∞–¥–∞–Ω–∏—è –ø–æ–∫–∞ –Ω–µ—Ç."

    # –ò—Å–ø–æ–ª—å–∑—É–µ–º edit_caption –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π —Å —Ñ–æ—Ç–æ –∏–ª–∏ edit_text –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
    await call.message.edit_caption(caption=task_message, reply_markup=check_menu_keyboard())
    await call.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å"
@dp.callback_query(F.data == "check_subscription")
async def check_subscription(call: types.CallbackQuery):
    task_data = db.get_task_data()
    if task_data:
        channels = task_data[0].split()  # –ò–∑–≤–ª–µ–∫–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤, —ç—Ç–æ task_data[0]
        not_subscribed_channels = []

        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–ø–æ–ª–Ω—è–ª –ª–∏ —É–∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–Ω–∏–µ
        task_completed = db.get_task_status(call.from_user.id)

        if task_completed:
            await call.message.answer("üëè–í—ã —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏ –∑–∞–¥–∞–Ω–∏–µ –∏ –ø–æ–ª—É—á–∏–ª–∏ 500 $Dinocoin.")
            await call.answer()
            return

        for channel in channels:
            channel_username = channel.strip().lstrip('@')  # –£–±–∏—Ä–∞–µ–º '@' –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞–Ω–∞–ª–∞
            try:
                member = await bot.get_chat_member(chat_id=f"@{channel_username}", user_id=call.from_user.id)
                if member.status not in ['member', 'administrator', 'creator']:
                    not_subscribed_channels.append(channel)
            except TelegramBadRequest:
                not_subscribed_channels.append(channel)

        if not not_subscribed_channels:
            # –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –Ω–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã, –Ω–∞—á–∏—Å–ª—è–µ–º –∫–æ–∏–Ω—ã
            await call.message.answer("üéâ–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ –≤—Å–µ –∫–∞–Ω–∞–ª—ã! –í–∞–º –Ω–∞—á–∏—Å–ª–µ–Ω–æ 500 $Dinocoinü§†.")
            await db.add_coins(call.from_user.id, 500)  # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–∏–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
            await db.set_task_completed(call.from_user.id)  # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ

            # –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –±–∞–ª–∞–Ω—Å
            user_score = await db.count_score(call.from_user.id)
            await call.message.answer(f"–í–∞—à —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å: {user_score} $Dinocoin.")
        else:
            not_subscribed_list = '\n'.join(not_subscribed_channels)
            await call.message.answer(f"‚ùó–í—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ –∫–∞–Ω–∞–ª—ã:\n{not_subscribed_list}")
    else:
        await call.message.answer("‚òπÔ∏è–ó–∞–¥–∞–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç.")

    await call.answer()

# –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–ª–∏–∫–∞
last_click_time = {}
missed_clicks_count = {}

# —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∫–ª–∏–∫
@dp.message(F.text.lower().contains('–∫–ª–∏–∫'))
async def click(message: types.Message):
    current_time = time.time()
    last_time = last_click_time.get(message.from_user.id)

    if last_time and (current_time - last_time) < 2:
        missed_clicks_count[message.from_user.id] = missed_clicks_count.get(message.from_user.id, 0) + 1
        if missed_clicks_count[message.from_user.id] % 3 == 0:
            await message.answer(f"<b>üîî–ö–ª–∏–∫ –Ω–µ –∑–∞—Å—á–∏—Ç–∞–Ω:\n–ü—Ä–æ—à–ª–æ –º–µ–Ω—å—à–µ 2 —Å–µ–∫—É–Ω–¥ —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–ª–∏–∫–∞</b>")
        return

    missed_clicks_count[message.from_user.id] = 0
    last_click_time[message.from_user.id] = current_time

    clicks = await db.get_user_clicks(message.from_user.id)

    if clicks is None:
        await db.add_user(message.from_user.id)
        clicks = 1
    else:
        await db.increment_user_clicks(message.from_user.id)
        clicks += 1
        await message.answer(text=f'–ù–∞ –≤–∞—à –±–∞–ª–∞–Ω—Å –∑–∞—á–∏—Å–ª–µ–Ω <b>+1 $Dinocoinüí∏</b>\n–ë–∞–ª–∞–Ω—Å –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—éüëõ', disable_notification=True)

    if clicks % 50 == 0:
        await message.answer("‚ùó–ù–µ –∑–∞–±—ã–≤–∞–π, —è –Ω–µ –∑–∞—Å—á–∏—Ç—ã–≤–∞—é –∫–ª–∏–∫–∏ —á–∞—â–µ –æ–¥–Ω–æ–≥–æ —Ä–∞–∑–∞ –≤ –¥–≤–µ —Å–µ–∫—É–Ω–¥—ã‚ùó")

    # –ü–µ—Ä–µ–¥–∞–µ–º 1 –∫–∞–∫ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ–≤—ã—Ö –∫–ª–∏–∫–æ–≤
    referrer_id = db.get_referrer(message.from_user.id)
    if referrer_id:
        await db.reward_referrer_with_percentage(referrer_id, 1)